<nav class="site-nav">
  <div class="nav-wrap">
    <a class="brand" href="{{ '/index.html' | relative_url }}">Chronicle</a>
    <button class="menu-toggle" aria-label="Toggle navigation" aria-expanded="false" aria-controls="nav-links">&#9776;</button>
    <ul class="links" id="nav-links">
      <li><a href="{{ '/index.html'     | relative_url }}">Home</a></li>
      <li><a href="{{ '/powers.html'    | relative_url }}">Great Powers</a></li>
      <li><a href="{{ '/samogitia.html' | relative_url }}">Samogitia Evolution</a></li>
      <li><a href="{{ '/armies.html'    | relative_url }}">Armies</a></li>
      <li><a href="{{ '/navies.html'    | relative_url }}">Royal Navy</a></li>
      <li><a href="{{ '/rulers.html'    | relative_url }}">Rulers & Advisors</a></li>
      <li><a href="{{ '/economy.html'   | relative_url }}">Economy</a></li>
      <li><a href="{{ '/maps.html'      | relative_url }}">Atlas</a></li>
      <li><a href="{{ '/timeline.html'  | relative_url }}">Timeline</a></li>
    </ul>
    <input id="searchBox" type="text" placeholder="Search...">
    <button id="themeToggle" class="theme-toggle" aria-label="Toggle theme">Toggle Theme</button>
  </div>
</nav>

<script>
  (function(){
    const here = location.pathname.replace(/\/+(?:index\.html)?$/, '').split('/').pop() || 'index.html';
    document.querySelectorAll('.site-nav .links a').forEach(a => {
      const link = a.getAttribute('href').replace(/\/+(?:index\.html)?$/, '').split('/').pop();
      if(link === here){
        a.classList.add('active');
      }
    });

    if(document.getElementById('themeToggle')){
      const themeScript = document.createElement('script');
      themeScript.src = "{{ '/assets/js/theme.js' | relative_url }}";
      themeScript.defer = true;
      document.head.appendChild(themeScript);
    }

    if(document.getElementById('searchBox')){
      const lunrScript = document.createElement('script');
      lunrScript.src = 'https://cdn.jsdelivr.net/npm/lunr/lunr.min.js';
      lunrScript.onload = () => {
        const searchScript = document.createElement('script');
        searchScript.src = "{{ '/assets/js/search.js' | relative_url }}";
        document.head.appendChild(searchScript);
      };
      document.head.appendChild(lunrScript);
    }

    const navToggleScript = document.createElement('script');
    navToggleScript.src = "{{ '/assets/js/navToggle.js' | relative_url }}";
    navToggleScript.defer = true;
    document.head.appendChild(navToggleScript);

    if('serviceWorker' in navigator){
      navigator.serviceWorker.register('{{ '/service-worker.js' | relative_url }}');
    }
  })();
</script>
