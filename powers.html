<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Powers of 1444</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root{--ink:#222;--muted:#666;--accent:#8b0000;--card:#fff;--bg:#f7f7f7;--line:#e6e6e6}
    html,body{margin:0;background:var(--bg);color:var(--ink);font-family:"Helvetica Neue",Arial,sans-serif;line-height:1.6}
    .banner{background:linear-gradient(90deg,var(--accent),#b22222);color:#fff;text-align:center;padding:2rem 1rem}
    .banner h1{margin:0;font-family:Georgia,serif;font-size:1.9rem}
    .banner p{margin:.4rem 0 0;color:#f0f0f0}

    .container{max-width:1200px;margin:2rem auto;padding:0 1rem}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
    @media(max-width:940px){.grid{grid-template-columns:1fr}}

    .card{background:var(--card);border:1px solid var(--line);border-radius:.6rem;box-shadow:0 1px 4px rgba(0,0,0,.05);padding:1rem}
    h2{font-family:Georgia,serif;color:var(--accent);font-size:1.2rem;margin:.2rem 0 1rem}

    table{width:100%;border-collapse:collapse;background:#fcfcfc;border:1px solid var(--line);border-radius:.4rem;overflow:hidden;font-size:.95rem}
    th,td{padding:.5rem .6rem;border-bottom:1px solid var(--line);text-align:left;white-space:nowrap}
    th{background:#f2e6e6;color:#4b0000}
    tr:last-child td{border-bottom:0}
    .muted{color:var(--muted);font-size:.9rem}

    canvas{width:100%!important;max-width:100%;height:480px!important;background:#fff;border:1px solid var(--line);border-radius:.4rem}
    .back{display:inline-block;margin:1.5rem 0 0;text-decoration:none;color:var(--accent);font-weight:700}
    .back:hover{text-decoration:underline}

    /* toolbar */
    .toolbar{display:flex;gap:.5rem;align-items:center;margin:.25rem 0 1rem}
    .toolbar button{
      border:1px solid var(--line);background:#fff;border-radius:.5rem;
      padding:.45rem .8rem;cursor:pointer;font-weight:600
    }
    .toolbar button:hover{background:#f6f6f6}
  </style>
</head>
<body>
<body>
  <body>
  <div id="nav-placeholder"></div>
  <script>
    fetch("nav.html")
      .then(r => r.text())
      .then(html => document.getElementById("nav-placeholder").innerHTML = html);
  </script>

  <!-- your page content follows -->

  <header class="banner">
    <h1>Powers of 1444</h1>
    <p>Army and Navy compositions at the dawn of the age</p>
  </header>

  <main class="container">
    <section class="grid">
      <!-- Army Table -->
      <article class="card">
        <h2>Army Composition (Infantry / Cavalry / Artillery)</h2>
        <table>
          <thead>
            <tr>
              <th>Country</th>
              <th>Total</th>
              <th>Inf</th>
              <th>Cav</th>
              <th>Art</th>
            </tr>
          </thead>
          <tbody id="army-rows"></tbody>
        </table>
        <p class="muted">Totals = Infantry + Cavalry + Artillery</p>
      </article>

      <!-- Navy Table -->
      <article class="card">
        <h2>Navy Composition (Heavy / Light / Galley / Transport)</h2>
        <table>
          <thead>
            <tr>
              <th>Country</th>
              <th>Total</th>
              <th>Heavy</th>
              <th>Light</th>
              <th>Galley</th>
              <th>Transport</th>
            </tr>
          </thead>
          <tbody id="navy-rows"></tbody>
        </table>
        <p class="muted">Totals = Heavy + Light + Galleys + Transports</p>
      </article>
    </section>

    <!-- Interactive Chart -->
    <section class="card" style="margin-top:2rem;">
      <h2>Evolution of Armies & Navies</h2>

      <!-- NEW: Toggle all -->
      <div class="toolbar">
        <button id="toggleAllBtn" type="button">Show all</button>
      </div>

      <canvas id="evolutionChart"></canvas>
      <p class="muted">Interactive: Hover for values, click legend to toggle individual countries, or use “Toggle all”.</p>
    </section>

    <a class="back" href="index.html">← Back to Chronicle Index</a>
  </main>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // ===== Armies =====
    const RAW_ARMIES_1444 = [
      { name:"Mamluks",inf:11000,cav:4000,art:0 },
      { name:"Muscovy",inf:11000,cav:4000,art:0 },
      { name:"Lithuania",inf:11000,cav:4000,art:0 },
      { name:"Aragon",inf:7000,cav:2000,art:3000 },
      { name:"Ottomans",inf:9000,cav:3000,art:0 },
      { name:"France",inf:8000,cav:3000,art:0 },
      { name:"Poland",inf:8000,cav:3000,art:0 },
      { name:"Uzbek",inf:8000,cav:2000,art:0 },
      { name:"Morocco",inf:7000,cav:3000,art:0 },
      { name:"Castille",inf:8000,cav:2000,art:0 },
      { name:"Bohemia",inf:8000,cav:2000,art:0 },
      { name:"England",inf:8000,cav:2000,art:0 },
      { name:"Kazan",inf:7000,cav:2000,art:0 },
      { name:"Venice",inf:7000,cav:2000,art:0 },
      { name:"Burgundy",inf:7000,cav:2000,art:0 },
      { name:"Hungary",inf:7000,cav:2000,art:0 },
      { name:"Austria",inf:6000,cav:2000,art:0 },
      { name:"Samogitia",inf:5000,cav:1000,art:0 }
    ];
    const ARMIES_1444 = RAW_ARMIES_1444.map(r=>({...r,total:r.inf+r.cav+r.art}));

    // ===== Navies =====
    const RAW_NAVIES_1444 = [
      { name:"England",heavy:4,light:6,galley:0,trans:7 },
      { name:"Ragusa",heavy:0,light:7,galley:5,trans:4 },
      { name:"Venice",heavy:0,light:5,galley:3,trans:7 },
      { name:"Gotland",heavy:0,light:7,galley:5,trans:3 },
      { name:"Lubeck",heavy:0,light:6,galley:4,trans:4 },
      { name:"Denmark",heavy:0,light:2,galley:6,trans:6 },
      { name:"Mamluks",heavy:0,light:2,galley:4,trans:7 },
      { name:"Novgorod",heavy:3,light:5,galley:0,trans:5 },
      { name:"Aragon",heavy:0,light:2,galley:5,trans:6 },
      { name:"Ottomans",heavy:0,light:2,galley:4,trans:7 },
      { name:"Tunis",heavy:0,light:2,galley:4,trans:6 },
      { name:"Genoa",heavy:0,light:5,galley:3,trans:4 },
      { name:"Portugal",heavy:3,light:4,galley:0,trans:5 },
      { name:"Castile",heavy:2,light:3,galley:0,trans:7 },
      { name:"Teutonic Order",heavy:0,light:2,galley:5,trans:5 },
      { name:"Livonian Order",heavy:0,light:2,galley:6,trans:4 },
      { name:"Samogitia",heavy:0,light:0,galley:0,trans:0 }
    ];
    const NAVIES_1444 = RAW_NAVIES_1444.map(r=>({...r,total:r.heavy+r.light+r.galley+r.trans}));

    // === Populate tables ===
    function fillTable(data,tbodyId,cols){
      const tbody=document.getElementById(tbodyId);
      data.forEach(r=>{
        const tr=document.createElement("tr");
        tr.innerHTML = `<td>${r.name}</td>
          <td>${r.total}</td>` + cols.map(c=>`<td>${r[c]}</td>`).join("");
        tbody.appendChild(tr);
      });
    }
    fillTable(ARMIES_1444,"army-rows",["inf","cav","art"]);
    fillTable(NAVIES_1444,"navy-rows",["heavy","light","galley","trans"]);

       // === Interactive chart (timeline-ready) ===
    const YEARS=["1444"]; // add more years later: ["1444","1447","1450",...]

    // helper: generate distinct colors
    function hslColor(i,total,sat=70,light=45){
      const hue=(i*360/total)%360;
      return `hsl(${hue},${sat}%,${light}%)`;
    }

    const datasets=[];
    let armyIndex=0;
    let navyIndex=0;

    // Armies datasets (warm colors)
    ARMIES_1444.forEach((r,i)=>{
      const color=hslColor(armyIndex++,ARMIES_1444.length,70,40);
      datasets.push({
        label:`${r.name} Army`,
        data:[r.total],
        borderColor:color,
        backgroundColor:color.replace("40%)","70%)"), // lighter fill
        hidden:true
      });
    });

    // Navies datasets (shift hue by 180° to get cool colors)
    NAVIES_1444.forEach((r,i)=>{
      const color=hslColor(navyIndex++,NAVIES_1444.length,65,35);
      datasets.push({
        label:`${r.name} Navy`,
        data:[r.total],
        borderColor:color,
        backgroundColor:color.replace("35%)","65%)"),
        hidden:true
      });
    });

    const ctx=document.getElementById("evolutionChart").getContext("2d");
    const evoChart=new Chart(ctx,{
      type:"line",
      data:{labels:YEARS,datasets},
      options:{
        responsive:true,
        interaction:{mode:"nearest",intersect:false},
        plugins:{legend:{display:true}},
        scales:{y:{beginAtZero:true}}
      }
    });


    // ===== Toggle All logic =====
    const toggleBtn=document.getElementById("toggleAllBtn");

    function isAllHidden(){
      // treat undefined as visible-by-default (which we don't use), so explicitly check for hidden !== false
      return evoChart.data.datasets.every(ds => ds.hidden === true);
    }
    function setAllHidden(hidden){
      evoChart.data.datasets.forEach(ds => { ds.hidden = hidden; });
      evoChart.update();
      toggleBtn.textContent = hidden ? "Show all" : "Hide all";
    }
    function toggleAll(){
      const shouldShow = isAllHidden(); // if all hidden -> show all, else hide all
      setAllHidden(!shouldShow ? true : false);
    }

    // initial label
    toggleBtn.textContent = "Show all";
    toggleBtn.addEventListener("click", toggleAll);
  </script>
</body>
</html>
