<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Powers of 1444</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="assets/css/styles.css">
  <style>
    /* Page-specific styles for Powers */
    .container{max-width:1200px;}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:1rem;}
    @media(max-width:940px){.grid{grid-template-columns:1fr;}}
    canvas{height:480px!important;}
    .toolbar{display:flex;gap:.5rem;align-items:center;margin:.25rem 0 1rem;}
    .toolbar button{border:1px solid var(--line);background:#fff;border-radius:.5rem;padding:.45rem .8rem;cursor:pointer;font-weight:600;}
    .toolbar button:hover{background:#f6f6f6;}
  </style>
</head>
<body>
  <div id="nav-placeholder"></div>
  <script>
    fetch("nav.html")
      .then(r => r.text())
      .then(html => document.getElementById("nav-placeholder").innerHTML = html);
  </script>

  <header class="banner">
    <h1>Powers of 1444</h1>
    <p>Army and Navy compositions at the dawn of the age</p>
  </header>

  <main class="container">
    <section class="grid">
      <!-- Army Table -->
      <article class="card">
        <h2>Army Composition (Infantry / Cavalry / Artillery)</h2>
        <table>
          <thead>
            <tr>
              <th>Country</th>
              <th>Total</th>
              <th>Inf</th>
              <th>Cav</th>
              <th>Art</th>
            </tr>
          </thead>
          <tbody id="army-rows"></tbody>
        </table>
        <p class="muted">Totals = Infantry + Cavalry + Artillery</p>
      </article>

      <!-- Navy Table -->
      <article class="card">
        <h2>Navy Composition (Heavy / Light / Galley / Transport)</h2>
        <table>
          <thead>
            <tr>
              <th>Country</th>
              <th>Total</th>
              <th>Heavy</th>
              <th>Light</th>
              <th>Galley</th>
              <th>Transport</th>
            </tr>
          </thead>
          <tbody id="navy-rows"></tbody>
        </table>
        <p class="muted">Totals = Heavy + Light + Galleys + Transports</p>
      </article>
    </section>

    <!-- Samogitia named armies (optional helper table) -->
    <section class="card" style="margin-top:1rem;">
      <h2>Samogitia Armies (1444–1446)</h2>
      <table>
        <thead>
          <tr><th>Year</th><th>Name</th><th>Commander</th><th>Inf</th><th>Cav</th><th>Art</th><th>Total</th></tr>
        </thead>
        <tbody>
          <tr>
            <td>1444</td><td><em>—</em></td><td><em>—</em></td>
            <td>5,000</td><td>1,000</td><td>0</td><td>6,000</td>
          </tr>
          <tr>
            <td>1445</td><td>Iron Wolf</td><td>Daugvilas Tyzenhaus</td>
            <td>5,000</td><td>3,000</td><td>2,000</td><td>10,000</td>
          </tr>
          <tr>
            <td>1446</td><td>Black Death</td><td>Kantibutas Giedraiciai</td>
            <td>5,000</td><td>3,000</td><td>2,000</td><td>10,000</td>
          </tr>
          <tr>
            <td colspan="3"><strong>1446 Combined</strong></td>
            <td><strong>10,000</strong></td>
            <td><strong>6,000</strong></td>
            <td><strong>4,000</strong></td>
            <td><strong>20,000</strong></td>
          </tr>
        </tbody>
      </table>
      <p class="muted">Combined totals assume both armies are active in 1446.</p>
    </section>

    <!-- Interactive Chart -->
    <section class="card" style="margin-top:2rem;">
      <h2>Evolution of Armies & Navies</h2>

      <!-- Toggle all -->
      <div class="toolbar">
        <button id="toggleAllBtn" type="button">Show all</button>
      </div>

      <canvas id="evolutionChart"></canvas>
      <p class="muted">Interactive: Hover for values, click legend to toggle individual countries, or use “Toggle all”.</p>
    </section>

    <a class="back" href="index.html">← Back to Chronicle Index</a>
  </main>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // ===== Armies (1444 snapshot) =====
    const RAW_ARMIES_1444 = [
      { name:"Mamluks",inf:11000,cav:4000,art:0 },
      { name:"Muscovy",inf:11000,cav:4000,art:0 },
      { name:"Lithuania",inf:11000,cav:4000,art:0 },
      { name:"Aragon",inf:7000,cav:2000,art:3000 },
      { name:"Ottomans",inf:9000,cav:3000,art:0 },
      { name:"France",inf:8000,cav:3000,art:0 },
      { name:"Poland",inf:8000,cav:3000,art:0 },
      { name:"Uzbek",inf:8000,cav:2000,art:0 },
      { name:"Morocco",inf:7000,cav:3000,art:0 },
      { name:"Castille",inf:8000,cav:2000,art:0 },
      { name:"Bohemia",inf:8000,cav:2000,art:0 },
      { name:"England",inf:8000,cav:2000,art:0 },
      { name:"Kazan",inf:7000,cav:2000,art:0 },
      { name:"Venice",inf:7000,cav:2000,art:0 },
      { name:"Burgundy",inf:7000,cav:2000,art:0 },
      { name:"Hungary",inf:7000,cav:2000,art:0 },
      { name:"Austria",inf:6000,cav:2000,art:0 },
      { name:"Samogitia",inf:5000,cav:1000,art:0 }
    ];
    const ARMIES_1444 = RAW_ARMIES_1444.map(r=>({...r,total:r.inf+r.cav+r.art}));

    // ===== Navies (1444 snapshot) =====
    const RAW_NAVIES_1444 = [
      { name:"England",heavy:4,light:6,galley:0,trans:7 },
      { name:"Ragusa",heavy:0,light:7,galley:5,trans:4 },
      { name:"Venice",heavy:0,light:5,galley:3,trans:7 },
      { name:"Gotland",heavy:0,light:7,galley:5,trans:3 },
      { name:"Lubeck",heavy:0,light:6,galley:4,trans:4 },
      { name:"Denmark",heavy:0,light:2,galley:6,trans:6 },
      { name:"Mamluks",heavy:0,light:2,galley:4,trans:7 },
      { name:"Novgorod",heavy:3,light:5,galley:0,trans:5 },
      { name:"Aragon",heavy:0,light:2,galley:5,trans:6 },
      { name:"Ottomans",heavy:0,light:2,galley:4,trans:7 },
      { name:"Tunis",heavy:0,light:2,galley:4,trans:6 },
      { name:"Genoa",heavy:0,light:5,galley:3,trans:4 },
      { name:"Portugal",heavy:3,light:4,galley:0,trans:5 },
      { name:"Castile",heavy:2,light:3,galley:0,trans:7 },
      { name:"Teutonic Order",heavy:0,light:2,galley:5,trans:5 },
      { name:"Livonian Order",heavy:0,light:2,galley:6,trans:4 },
      { name:"Samogitia",heavy:0,light:0,galley:0,trans:0 }
    ];
    const NAVIES_1444 = RAW_NAVIES_1444.map(r=>({...r,total:r.heavy+r.light+r.galley+r.trans}));

    // === Samogitia multi-year data (armies) ===
    // 1445: Iron Wolf (5k/3k/2k), 1446 adds Black Death (5k/3k/2k) -> combined totals shown in chart
    const SAMOGITIA_BY_YEAR = {
      "1444": { inf: 5000, cav: 1000, art: 0 },          // baseline
      "1445": { inf: 5000, cav: 3000, art: 2000 },       // Iron Wolf
      "1446": { inf: 10000, cav: 6000, art: 4000 }       // Iron Wolf + Black Death (combined)
    };

    // === Populate tables ===
    function fillTable(data,tbodyId,cols){
      const tbody=document.getElementById(tbodyId);
      data.forEach(r=>{
        const tr=document.createElement("tr");
        tr.innerHTML = `<td>${r.name}</td>
          <td>${r.total}</td>` + cols.map(c=>`<td>${r[c]}</td>`).join("");
        tbody.appendChild(tr);
      });
    }
    fillTable(ARMIES_1444,"army-rows",["inf","cav","art"]);
    fillTable(NAVIES_1444,"navy-rows",["heavy","light","galley","trans"]);

    // === Interactive chart (timeline-ready) ===
    const YEARS=["1444","1445","1446"]; // extend later as needed

    // helper: generate distinct colors
    function hslColor(i,total,sat=70,light=45){
      const hue=(i*360/total)%360;
      return `hsl(${hue},${sat}%,${light}%)`;
    }

    const datasets=[];
    let armyIndex=0;
    let navyIndex=0;

    // Armies datasets (warm colors) — Samogitia has multi-year values, others 1444-only
    ARMIES_1444.forEach((r)=>{
      const color = hslColor(armyIndex++, ARMIES_1444.length, 70, 40);
      const series = YEARS.map(y => {
        if (r.name === "Samogitia") {
          const v = SAMOGITIA_BY_YEAR[y];
          return v ? (v.inf + v.cav + v.art) : null;
        }
        return y === "1444" ? r.total : null;
      });

      datasets.push({
        label:`${r.name} Army`,
        data:series,
        borderColor:color,
        backgroundColor:color,
        hidden:true
      });
    });

    // Navies datasets (cool colors) — all 1444-only for now
    NAVIES_1444.forEach((r)=>{
      const color=hslColor(navyIndex++,NAVIES_1444.length,65,35);
      datasets.push({
        label:`${r.name} Navy`,
        data:[r.total, null, null],
        borderColor:color,
        backgroundColor:color,
        hidden:true
      });
    });

    const ctx=document.getElementById("evolutionChart").getContext("2d");
    const evoChart=new Chart(ctx,{
      type:"line",
      data:{labels:YEARS,datasets},
      options:{
        responsive:true,
        interaction:{mode:"nearest",intersect:false},
        plugins:{legend:{display:true}},
        elements:{line:{tension:0.25}},
        scales:{y:{beginAtZero:true}}
      }
    });

    // ===== Toggle All logic =====
    const toggleBtn=document.getElementById("toggleAllBtn");

    function isAllHidden(){
      return evoChart.data.datasets.every(ds => ds.hidden === true);
    }
    function setAllHidden(hidden){
      evoChart.data.datasets.forEach(ds => { ds.hidden = hidden; });
      evoChart.update();
      toggleBtn.textContent = hidden ? "Show all" : "Hide all";
    }
    function toggleAll(){
      const shouldShow = isAllHidden();
      setAllHidden(!shouldShow ? true : false);
    }

    // initial label
    toggleBtn.textContent = "Show all";
    toggleBtn.addEventListener("click", toggleAll);
  </script>
</body>
</html>
